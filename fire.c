#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <raylib.h>

#define SCREEN_W 960
#define SCREEN_H 720
#define REZ_W 320
#define REZ_H 240

char shadercode[] =
"#version 330\n"

"const int colors = 256;\n"

"// Input fragment attributes (from fragment shader)\n"
"in vec2 fragTexCoord;\n"
"in vec4 fragColor;\n"

"// Input uniform values\n"
"uniform sampler2D texture0;\n"
"uniform ivec3 palette[colors];\n"

"// Output fragment color\n"
"out vec4 finalColor;\n"

"void main()\n"
"{\n"
"    // Texel color fetching from texture sampler\n"
"    vec4 texelColor = texture(texture0, fragTexCoord)*fragColor;\n"

"    float intensity = texelColor.r;\n"
"    vec3 color = vec3(1.0, 0.5, 0.0);\n"
"    finalColor = vec4(color * intensity, texelColor.a);\n"

    // Convert the (normalized) texel color RED component (GB would work, too)
    // to the palette index by scaling up from [0, 1] to [0, 255].
    //int index = int(texelColor.r * 255.0);
    //ivec3 color = palette[index];

    // Calculate final fragment color. Note that the palette color components
    // are defined in the range [0, 255] and need to be normalized to [0, 1]
    // for OpenGL to work.
    //finalColor = vec4(color/255.0, texelColor.a);
"}\n";

struct glyph {
    int code;
    short width;
    short height;
    short padding;
    unsigned short rows[16];
};

struct glyph glyphs[] = {
{0,7,12,0,{21504,33280,0,33280,0,33280,0,33280,0,33280,0,43520,}},
{1,7,12,0,{0,0,0,0,4096,14336,31744,14336,4096,0,0,0,}},
{2,7,12,0,{21504,43520,21504,43520,21504,43520,21504,43520,21504,43520,21504,43520,}},
{3,7,12,0,{0,20480,20480,28672,20480,24064,1024,1024,1024,1024,0,0,}},
{4,7,12,0,{0,28672,16384,24576,16384,19968,2048,3072,2048,2048,0,0,}},
{5,7,12,0,{0,12288,16384,16384,16384,15872,2560,3072,2560,2560,0,0,}},
{6,7,12,0,{0,16384,16384,16384,16384,32256,2048,3072,2048,2048,0,0,}},
{7,7,12,0,{0,0,4096,10240,4096,0,0,0,0,0,0,0,}},
{8,7,12,0,{0,0,0,4096,4096,31744,4096,4096,0,31744,0,0,}},
{9,7,12,0,{0,24576,20480,20480,20480,22528,2048,2048,2048,3584,0,0,}},
{10,7,12,0,{0,20480,20480,20480,8192,11776,1024,1024,1024,1024,0,0,}},
{11,7,12,0,{4096,4096,4096,4096,4096,4096,61440,0,0,0,0,0,}},
{12,7,12,0,{0,0,0,0,0,0,61440,4096,4096,4096,4096,4096,}},
{13,7,12,0,{0,0,0,0,0,0,7680,4096,4096,4096,4096,4096,}},
{14,7,12,0,{4096,4096,4096,4096,4096,4096,7680,0,0,0,0,0,}},
{15,7,12,0,{4096,4096,4096,4096,4096,4096,65024,4096,4096,4096,4096,4096,}},
{16,7,12,0,{65024,0,0,0,0,0,0,0,0,0,0,0,}},
{17,7,12,0,{0,0,0,65024,0,0,0,0,0,0,0,0,}},
{18,7,12,0,{0,0,0,0,0,0,65024,0,0,0,0,0,}},
{19,7,12,0,{0,0,0,0,0,0,0,0,0,65024,0,0,}},
{20,7,12,0,{0,0,0,0,0,0,0,0,0,0,0,65024,}},
{21,7,12,0,{4096,4096,4096,4096,4096,4096,7680,4096,4096,4096,4096,4096,}},
{22,7,12,0,{4096,4096,4096,4096,4096,4096,61440,4096,4096,4096,4096,4096,}},
{23,7,12,0,{4096,4096,4096,4096,4096,4096,65024,0,0,0,0,0,}},
{24,7,12,0,{0,0,0,0,0,0,65024,4096,4096,4096,4096,4096,}},
{25,7,12,0,{4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,}},
{26,7,12,0,{0,0,0,1536,6144,24576,6144,1536,0,32256,0,0,}},
{27,7,12,0,{0,0,0,24576,6144,1536,6144,24576,0,32256,0,0,}},
{28,7,12,0,{0,0,0,0,32256,9216,9216,9216,9216,9216,0,0,}},
{29,7,12,0,{0,0,0,0,1024,32256,2048,32256,4096,0,0,0,}},
{30,7,12,0,{0,0,6144,8192,8192,30720,8192,8192,16384,31744,0,0,}},
{31,7,12,0,{0,0,0,7168,8704,30720,8192,30720,8704,7168,0,0,}},
{32,7,12,0,{0,0,0,0,0,0,0,0,0,0,0,0,}},
{33,7,12,0,{0,0,4096,4096,4096,4096,4096,4096,0,4096,4096,0,}},
{34,7,12,0,{0,27648,27648,27648,0,0,0,0,0,0,0,0,}},
{35,7,12,0,{0,0,10240,10240,31744,10240,10240,31744,10240,10240,0,0,}},
{36,7,12,0,{0,0,4096,15360,20480,20480,14336,5120,5120,30720,4096,0,}},
{37,7,12,0,{0,0,8192,20992,21504,10240,5120,10752,18944,1024,0,0,}},
{38,7,12,0,{0,0,12288,18432,18432,12800,18944,17408,17408,14848,0,0,}},
{39,7,12,0,{0,6144,6144,6144,0,0,0,0,0,0,0,0,}},
{40,7,12,0,{0,2048,4096,4096,8192,8192,8192,8192,8192,4096,4096,2048,}},
{41,7,12,0,{0,8192,4096,4096,2048,2048,2048,2048,2048,4096,4096,8192,}},
{42,7,12,0,{0,0,0,0,4096,21504,14336,21504,4096,0,0,0,}},
{43,7,12,0,{0,0,0,0,4096,4096,31744,4096,4096,0,0,0,}},
{44,7,12,0,{0,0,0,0,0,0,0,0,6144,6144,4096,8192,}},
{45,7,12,0,{0,0,0,0,0,0,31744,0,0,0,0,0,}},
{46,7,12,0,{0,0,0,0,0,0,0,0,6144,6144,0,0,}},
{47,7,12,0,{0,1024,1024,2048,2048,4096,4096,8192,8192,16384,16384,0,}},
{48,7,12,0,{0,0,14336,17408,19456,21504,25600,17408,17408,14336,0,0,}},
{49,7,12,0,{0,0,4096,12288,20480,4096,4096,4096,4096,31744,0,0,}},
{50,7,12,0,{0,0,14336,17408,1024,2048,4096,8192,16384,31744,0,0,}},
{51,7,12,0,{0,0,14336,17408,1024,6144,1024,1024,17408,14336,0,0,}},
{52,7,12,0,{0,0,1024,3072,5120,9216,17408,32256,1024,1024,0,0,}},
{53,7,12,0,{0,0,31744,16384,16384,30720,1024,1024,17408,14336,0,0,}},
{54,7,12,0,{0,0,14336,16384,16384,30720,17408,17408,17408,14336,0,0,}},
{55,7,12,0,{0,0,31744,1024,2048,2048,4096,4096,8192,8192,0,0,}},
{56,7,12,0,{0,0,14336,17408,17408,14336,17408,17408,17408,14336,0,0,}},
{57,7,12,0,{0,0,14336,17408,17408,17408,15360,1024,1024,14336,0,0,}},
{58,7,12,0,{0,0,0,0,6144,6144,0,0,6144,6144,0,0,}},
{59,7,12,0,{0,0,0,0,6144,6144,0,0,6144,6144,4096,8192,}},
{60,7,12,0,{0,0,0,1024,2048,4096,8192,4096,2048,1024,0,0,}},
{61,7,12,0,{0,0,0,0,0,31744,0,31744,0,0,0,0,}},
{62,7,12,0,{0,0,0,8192,4096,2048,1024,2048,4096,8192,0,0,}},
{63,7,12,0,{0,0,14336,17408,1024,2048,4096,4096,0,4096,4096,0,}},
{64,7,12,0,{0,0,15360,16896,23040,23040,23040,23552,16384,15360,0,0,}},
{65,7,12,0,{0,0,14336,17408,17408,17408,31744,17408,17408,17408,0,0,}},
{66,7,12,0,{0,0,28672,18432,18432,30720,17408,17408,17408,30720,0,0,}},
{67,7,12,0,{0,0,14336,17408,16384,16384,16384,16384,17408,14336,0,0,}},
{68,7,12,0,{0,0,28672,18432,17408,17408,17408,17408,18432,28672,0,0,}},
{69,7,12,0,{0,0,31744,16384,16384,30720,16384,16384,16384,31744,0,0,}},
{70,7,12,0,{0,0,31744,16384,16384,30720,16384,16384,16384,16384,0,0,}},
{71,7,12,0,{0,0,14336,17408,16384,16384,19456,17408,17408,15360,0,0,}},
{72,7,12,0,{0,0,17408,17408,17408,31744,17408,17408,17408,17408,0,0,}},
{73,7,12,0,{0,0,14336,4096,4096,4096,4096,4096,4096,14336,0,0,}},
{74,7,12,0,{0,0,14336,2048,2048,2048,2048,2048,2048,28672,0,0,}},
{75,7,12,0,{0,0,17408,18432,20480,24576,24576,20480,18432,17408,0,0,}},
{76,7,12,0,{0,0,16384,16384,16384,16384,16384,16384,16384,31744,0,0,}},
{77,7,12,0,{0,0,17408,27648,21504,21504,21504,17408,17408,17408,0,0,}},
{78,7,12,0,{0,0,17408,25600,25600,21504,21504,19456,19456,17408,0,0,}},
{79,7,12,0,{0,0,14336,17408,17408,17408,17408,17408,17408,14336,0,0,}},
{80,7,12,0,{0,0,30720,17408,17408,17408,30720,16384,16384,16384,0,0,}},
{81,7,12,0,{0,0,14336,17408,17408,17408,17408,17408,17408,14336,3584,0,}},
{82,7,12,0,{0,0,30720,17408,17408,17408,30720,18432,17408,17408,0,0,}},
{83,7,12,0,{0,0,14336,17408,16384,12288,2048,1024,17408,14336,0,0,}},
{84,7,12,0,{0,0,31744,4096,4096,4096,4096,4096,4096,4096,0,0,}},
{85,7,12,0,{0,0,17408,17408,17408,17408,17408,17408,17408,14336,0,0,}},
{86,7,12,0,{0,0,17408,17408,17408,10240,10240,10240,4096,4096,0,0,}},
{87,7,12,0,{0,0,17408,17408,17408,21504,21504,21504,27648,17408,0,0,}},
{88,7,12,0,{0,0,17408,17408,10240,4096,4096,10240,17408,17408,0,0,}},
{89,7,12,0,{0,0,17408,17408,10240,10240,4096,4096,4096,4096,0,0,}},
{90,7,12,0,{0,0,31744,1024,2048,4096,8192,16384,16384,31744,0,0,}},
{91,7,12,0,{0,14336,8192,8192,8192,8192,8192,8192,8192,8192,8192,14336,}},
{92,7,12,0,{0,16384,16384,8192,8192,4096,4096,2048,2048,1024,1024,0,}},
{93,7,12,0,{0,14336,2048,2048,2048,2048,2048,2048,2048,2048,2048,14336,}},
{94,7,12,0,{0,0,4096,10240,17408,0,0,0,0,0,0,0,}},
{95,7,12,0,{0,0,0,0,0,0,0,0,0,0,31744,0,}},
{96,7,12,0,{0,8192,4096,2048,0,0,0,0,0,0,0,0,}},
{97,7,12,0,{0,0,0,0,14336,1024,15360,17408,17408,15360,0,0,}},
{98,7,12,0,{0,0,16384,16384,30720,17408,17408,17408,17408,30720,0,0,}},
{99,7,12,0,{0,0,0,0,15360,16384,16384,16384,16384,15360,0,0,}},
{100,7,12,0,{0,0,1024,1024,15360,17408,17408,17408,17408,15360,0,0,}},
{101,7,12,0,{0,0,0,0,14336,17408,31744,16384,16384,14336,0,0,}},
{102,7,12,0,{0,0,7168,8192,8192,30720,8192,8192,8192,8192,0,0,}},
{103,7,12,0,{0,0,0,0,15360,17408,17408,17408,17408,15360,1024,14336,}},
{104,7,12,0,{0,0,16384,16384,30720,17408,17408,17408,17408,17408,0,0,}},
{105,7,12,0,{0,0,4096,4096,0,12288,4096,4096,4096,14336,0,0,}},
{106,7,12,0,{0,0,2048,2048,0,6144,2048,2048,2048,2048,2048,28672,}},
{107,7,12,0,{0,0,16384,16384,16384,18432,20480,28672,18432,17408,0,0,}},
{108,7,12,0,{0,0,12288,4096,4096,4096,4096,4096,4096,6144,0,0,}},
{109,7,12,0,{0,0,0,0,26624,21504,21504,17408,17408,17408,0,0,}},
{110,7,12,0,{0,0,0,0,30720,17408,17408,17408,17408,17408,0,0,}},
{111,7,12,0,{0,0,0,0,14336,17408,17408,17408,17408,14336,0,0,}},
{112,7,12,0,{0,0,0,0,30720,17408,17408,17408,17408,30720,16384,16384,}},
{113,7,12,0,{0,0,0,0,15360,17408,17408,17408,17408,15360,1024,1024,}},
{114,7,12,0,{0,0,0,0,22528,25600,16384,16384,16384,16384,0,0,}},
{115,7,12,0,{0,0,0,0,14336,16384,12288,2048,2048,28672,0,0,}},
{116,7,12,0,{0,0,8192,8192,30720,8192,8192,8192,8192,7168,0,0,}},
{117,7,12,0,{0,0,0,0,17408,17408,17408,17408,17408,15360,0,0,}},
{118,7,12,0,{0,0,0,0,17408,17408,10240,10240,4096,4096,0,0,}},
{119,7,12,0,{0,0,0,0,17408,17408,21504,21504,27648,17408,0,0,}},
{120,7,12,0,{0,0,0,0,17408,10240,4096,4096,10240,17408,0,0,}},
{121,7,12,0,{0,0,0,0,17408,17408,17408,17408,17408,15360,1024,14336,}},
{122,7,12,0,{0,0,0,0,30720,2048,4096,8192,16384,30720,0,0,}},
{123,7,12,0,{0,3072,4096,4096,4096,4096,24576,4096,4096,4096,4096,3072,}},
{124,7,12,0,{0,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,}},
{125,7,12,0,{0,24576,4096,4096,4096,4096,3072,4096,4096,4096,4096,24576,}},
{126,7,12,0,{0,0,0,0,0,12800,23040,19456,0,0,0,0,}},
{127,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{128,7,12,0,{0,0,7168,8704,8192,30720,8192,30720,8704,7168,0,0,}},
{129,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{130,7,12,0,{0,0,0,0,0,0,0,0,4096,4096,8192,0,}},
{131,7,12,0,{0,0,3072,4096,4096,14336,4096,4096,4096,4096,8192,0,}},
{132,7,12,0,{0,0,0,0,0,0,0,0,9216,9216,18432,0,}},
{133,7,12,0,{0,0,0,0,0,0,0,0,0,21504,0,0,}},
{134,7,12,0,{0,0,4096,4096,31744,4096,4096,4096,4096,4096,0,0,}},
{135,7,12,0,{0,0,4096,4096,31744,4096,4096,31744,4096,4096,0,0,}},
{136,7,12,0,{0,4096,10240,0,0,0,0,0,0,0,0,0,}},
{137,7,12,0,{0,0,25088,25600,2048,4096,8192,16384,13824,13824,0,0,}},
{138,7,12,0,{0,10240,4096,0,14336,17408,12288,2048,17408,14336,0,0,}},
{139,7,12,0,{0,0,0,0,2048,4096,8192,4096,2048,0,0,0,}},
{140,7,12,0,{0,0,0,15872,18432,18432,19456,18432,18432,15872,0,0,}},
{141,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{142,7,12,0,{0,10240,4096,0,31744,2048,4096,8192,16384,31744,0,0,}},
{143,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{144,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{145,7,12,0,{0,2048,4096,4096,0,0,0,0,0,0,0,0,}},
{146,7,12,0,{0,4096,4096,8192,0,0,0,0,0,0,0,0,}},
{147,7,12,0,{0,9216,18432,18432,0,0,0,0,0,0,0,0,}},
{148,7,12,0,{0,9216,9216,18432,0,0,0,0,0,0,0,0,}},
{149,7,12,0,{0,0,0,0,6144,15360,15360,6144,0,0,0,0,}},
{150,7,12,0,{0,0,0,0,0,0,15360,0,0,0,0,0,}},
{151,7,12,0,{0,0,0,0,0,0,32256,0,0,0,0,0,}},
{152,7,12,0,{0,5120,10240,0,0,0,0,0,0,0,0,0,}},
{153,7,12,0,{0,31232,11776,10752,10752,0,0,0,0,0,0,0,}},
{154,7,12,0,{0,0,5120,2048,0,7168,8192,6144,1024,14336,0,0,}},
{155,7,12,0,{0,0,0,0,8192,4096,2048,4096,8192,0,0,0,}},
{156,7,12,0,{0,0,0,0,15872,18944,19968,18432,18432,15872,0,0,}},
{157,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{158,7,12,0,{0,0,10240,4096,0,14336,2048,4096,8192,14336,0,0,}},
{159,7,12,0,{0,10240,0,17408,17408,10240,4096,4096,4096,4096,0,0,}},
{160,7,12,0,{0,31744,17408,17408,17408,17408,17408,17408,17408,17408,31744,0,}},
{161,7,12,0,{0,4096,4096,0,4096,4096,4096,4096,4096,4096,0,0,}},
{162,7,12,0,{0,0,0,4096,14336,20480,20480,20480,14336,4096,0,0,}},
{163,7,12,0,{0,0,6144,9216,8192,28672,8192,8192,16384,31744,0,0,}},
{164,7,12,0,{0,0,0,0,17408,14336,10240,14336,17408,0,0,0,}},
{165,7,12,0,{0,0,17408,17408,10240,4096,14336,4096,14336,4096,0,0,}},
{166,7,12,0,{0,0,4096,4096,4096,0,0,4096,4096,4096,0,0,}},
{167,7,12,0,{0,0,6144,9216,8192,6144,9216,6144,1024,9216,6144,0,}},
{168,7,12,0,{0,0,10240,0,0,0,0,0,0,0,0,0,}},
{169,7,12,0,{0,15360,16896,23040,20992,23040,16896,15360,0,0,0,0,}},
{170,7,12,0,{0,6144,1024,7168,9216,7168,0,0,0,0,0,0,}},
{171,7,12,0,{0,0,0,4608,9216,18432,9216,4608,0,0,0,0,}},
{172,7,12,0,{0,0,0,0,31744,1024,1024,0,0,0,0,0,}},
{173,7,12,0,{0,0,0,0,0,0,0,0,0,14336,0,0,}},
{174,7,12,0,{15360,16896,23040,20992,20992,16896,15360,0,0,0,0,0,}},
{175,7,12,0,{0,31744,0,0,0,0,0,0,0,0,0,0,}},
{176,7,12,0,{0,0,6144,9216,9216,6144,0,0,0,0,0,0,}},
{177,7,12,0,{0,0,0,4096,4096,31744,4096,4096,31744,0,0,0,}},
{178,7,12,0,{0,12288,2048,4096,8192,14336,0,0,0,0,0,0,}},
{179,7,12,0,{0,14336,2048,6144,2048,14336,0,0,0,0,0,0,}},
{180,7,12,0,{0,2048,4096,8192,0,0,0,0,0,0,0,0,}},
{181,7,12,0,{0,0,0,0,17408,17408,17408,17408,17408,30720,16384,16384,}},
{182,7,12,0,{0,0,31744,26624,26624,10240,10240,10240,10240,10240,0,0,}},
{183,7,12,0,{0,0,0,0,0,6144,6144,0,0,0,0,0,}},
{184,7,12,0,{0,0,0,0,0,0,0,0,4096,4096,8192,0,}},
{185,7,12,0,{0,4096,12288,4096,4096,14336,0,0,0,0,0,0,}},
{186,7,12,0,{0,4096,10240,10240,4096,0,0,0,0,0,0,0,}},
{187,7,12,0,{0,0,0,0,18432,9216,4608,9216,18432,0,0,0,}},
{188,7,12,0,{0,8192,24576,8704,9216,10752,5632,10752,19968,512,0,0,}},
{189,7,12,0,{0,8192,24576,8704,9216,10240,5632,8704,17408,1536,0,0,}},
{190,7,12,0,{0,24576,8192,25088,9216,27136,5632,10752,19968,512,0,0,}},
{191,7,12,0,{0,4096,4096,0,4096,4096,2048,1024,17408,14336,0,0,}},
{192,7,12,0,{0,8192,4096,0,14336,17408,17408,31744,17408,17408,0,0,}},
{193,7,12,0,{0,2048,4096,0,14336,17408,17408,31744,17408,17408,0,0,}},
{194,7,12,0,{0,4096,10240,0,14336,17408,17408,31744,17408,17408,0,0,}},
{195,7,12,0,{0,10240,20480,0,14336,17408,17408,31744,17408,17408,0,0,}},
{196,7,12,0,{0,10240,0,14336,17408,17408,17408,31744,17408,17408,0,0,}},
{197,7,12,0,{0,4096,10240,4096,14336,17408,17408,31744,17408,17408,0,0,}},
{198,7,12,0,{0,0,15872,18432,18432,18432,31744,18432,18432,19968,0,0,}},
{199,7,12,0,{0,0,15360,16384,16384,16384,16384,16384,16384,15360,4096,12288,}},
{200,7,12,0,{0,8192,4096,0,31744,16384,30720,16384,16384,31744,0,0,}},
{201,7,12,0,{0,2048,4096,0,31744,16384,30720,16384,16384,31744,0,0,}},
{202,7,12,0,{0,4096,10240,0,31744,16384,30720,16384,16384,31744,0,0,}},
{203,7,12,0,{0,0,10240,0,31744,16384,30720,16384,16384,31744,0,0,}},
{204,7,12,0,{0,8192,4096,0,14336,4096,4096,4096,4096,14336,0,0,}},
{205,7,12,0,{0,2048,4096,0,14336,4096,4096,4096,4096,14336,0,0,}},
{206,7,12,0,{0,4096,10240,0,14336,4096,4096,4096,4096,14336,0,0,}},
{207,7,12,0,{0,10240,0,14336,4096,4096,4096,4096,4096,14336,0,0,}},
{208,7,12,0,{0,0,14336,9216,8704,31232,8704,8704,9216,14336,0,0,}},
{209,7,12,0,{0,10240,20480,0,17408,25600,21504,19456,17408,17408,0,0,}},
{210,7,12,0,{0,8192,4096,0,14336,17408,17408,17408,17408,14336,0,0,}},
{211,7,12,0,{0,2048,4096,0,14336,17408,17408,17408,17408,14336,0,0,}},
{212,7,12,0,{0,4096,10240,0,14336,17408,17408,17408,17408,14336,0,0,}},
{213,7,12,0,{0,10240,20480,0,14336,17408,17408,17408,17408,14336,0,0,}},
{214,7,12,0,{0,10240,0,14336,17408,17408,17408,17408,17408,14336,0,0,}},
{215,7,12,0,{0,0,0,0,17408,10240,4096,10240,17408,0,0,0,}},
{216,7,12,0,{0,0,0,14848,17408,19456,21504,25600,17408,47104,0,0,}},
{217,7,12,0,{0,8192,4096,0,17408,17408,17408,17408,17408,14336,0,0,}},
{218,7,12,0,{0,2048,4096,0,17408,17408,17408,17408,17408,14336,0,0,}},
{219,7,12,0,{0,4096,10240,0,17408,17408,17408,17408,17408,14336,0,0,}},
{220,7,12,0,{0,10240,0,17408,17408,17408,17408,17408,17408,14336,0,0,}},
{221,7,12,0,{0,2048,4096,0,17408,17408,10240,4096,4096,4096,0,0,}},
{222,7,12,0,{0,0,0,8192,8192,14336,10240,14336,8192,8192,0,0,}},
{223,7,12,0,{0,0,12288,18432,18432,20480,18432,17408,17408,22528,16384,16384,}},
{224,7,12,0,{0,8192,4096,0,14336,1024,15360,17408,17408,15360,0,0,}},
{225,7,12,0,{0,2048,4096,0,14336,1024,15360,17408,17408,15360,0,0,}},
{226,7,12,0,{0,4096,10240,0,14336,1024,15360,17408,17408,15360,0,0,}},
{227,7,12,0,{0,10240,20480,0,14336,1024,15360,17408,17408,15360,0,0,}},
{228,7,12,0,{0,0,10240,0,14336,1024,15360,17408,17408,15360,0,0,}},
{229,7,12,0,{0,4096,10240,4096,14336,1024,15360,17408,17408,15360,0,0,}},
{230,7,12,0,{0,0,0,0,13312,2560,14848,19968,18432,13824,0,0,}},
{231,7,12,0,{0,0,0,0,7168,8192,8192,8192,8192,7168,2048,6144,}},
{232,7,12,0,{0,8192,4096,0,14336,17408,31744,16384,16384,14336,0,0,}},
{233,7,12,0,{0,2048,4096,0,14336,17408,31744,16384,16384,14336,0,0,}},
{234,7,12,0,{0,4096,10240,0,14336,17408,31744,16384,16384,14336,0,0,}},
{235,7,12,0,{0,0,10240,0,14336,17408,31744,16384,16384,14336,0,0,}},
{236,7,12,0,{0,0,8192,4096,0,12288,4096,4096,4096,14336,0,0,}},
{237,7,12,0,{0,0,2048,4096,0,12288,4096,4096,4096,14336,0,0,}},
{238,7,12,0,{0,0,4096,10240,0,12288,4096,4096,4096,14336,0,0,}},
{239,7,12,0,{0,0,0,10240,0,12288,4096,4096,4096,14336,0,0,}},
{240,7,12,0,{0,0,10240,4096,10240,1024,15360,17408,17408,14336,0,0,}},
{241,7,12,0,{0,0,10240,20480,0,30720,17408,17408,17408,17408,0,0,}},
{242,7,12,0,{0,0,8192,4096,0,14336,17408,17408,17408,14336,0,0,}},
{243,7,12,0,{0,0,2048,4096,0,14336,17408,17408,17408,14336,0,0,}},
{244,7,12,0,{0,0,4096,10240,0,14336,17408,17408,17408,14336,0,0,}},
{245,7,12,0,{0,0,10240,20480,0,14336,17408,17408,17408,14336,0,0,}},
{246,7,12,0,{0,0,0,10240,0,14336,17408,17408,17408,14336,0,0,}},
{247,7,12,0,{0,0,0,0,4096,0,31744,0,4096,0,0,0,}},
{248,7,12,0,{0,0,0,0,6656,9216,11264,13312,9216,22528,0,0,}},
{249,7,12,0,{0,0,8192,4096,0,17408,17408,17408,17408,15360,0,0,}},
{250,7,12,0,{0,0,2048,4096,0,17408,17408,17408,17408,15360,0,0,}},
{251,7,12,0,{0,0,4096,10240,0,17408,17408,17408,17408,15360,0,0,}},
{252,7,12,0,{0,0,10240,0,17408,17408,17408,17408,17408,15360,0,0,}},
{253,7,12,0,{0,0,2048,4096,0,17408,17408,17408,17408,15360,1024,14336,}},
{254,7,12,0,{0,0,16384,16384,30720,17408,17408,17408,30720,16384,16384,0,}},
{255,7,12,0,{0,0,10240,0,17408,17408,17408,17408,17408,15360,1024,14336,}},
};

int colors[256][3];

void clear(unsigned char * pixels) {
    for(int i = 0; i < REZ_W * REZ_H; i++) pixels[i] = 0;
}

void block(int l, int r, int t, int b, int color, unsigned char * pixels) {
    int ll = l < 0 ? 0 : l > REZ_W - 1 ? REZ_W - 1 : l;
    int rr = r < 0 ? 0 : r > REZ_W - 1 ? REZ_W - 1 : r;
    int tt = t < 0 ? 0 : t > REZ_H - 1 ? REZ_H - 1 : t;
    int bb = b < 0 ? 0 : b > REZ_H - 1 ? REZ_H - 1 : b;
    for(int i = ll; i < rr; i++){
        for(int j = tt; j < bb; j++){
            pixels[REZ_W*j + i] = color;
        }
    }
}

static inline int clamp(int i, int modulus){
    int ii = i;
    while(i < 0) i += modulus;
    while(i >= modulus) i -= modulus;
    return ii;
}

static inline int sample(unsigned char * pixels, int i, int j){
    if(i < 0 || i >= REZ_W || j < 0 || j >= REZ_H) return 0;
/*
    while(i < 0)      i += REZ_W;
    while(i >= REZ_W) i -= REZ_W;
    while(j < 0)      j += REZ_H;
    while(j >= REZ_H) j -= REZ_H;
*/
    return pixels[j*REZ_W + i];
}

static inline void write(unsigned char * pixels, int x, int y, int color) {
    while(x < 0)      x += REZ_W;
    while(x >= REZ_W) x -= REZ_W;
    while(y < 0)      y += REZ_H;
    while(y >= REZ_H) y -= REZ_H;
    pixels[y*REZ_W + x] = color;
}

void drawGlyph(int x, int y, struct glyph *g, unsigned char * pixels) {
    int w = g->width;
    int h = g->height;
    for(int i = 0; i < h; i++){
        unsigned short row = g->rows[i];
        for(int j = x; j < x+w; j++) {
            if(row & 0x8000) write(pixels, j, i+y, 255);
            row <<= 1;
        }
    }
}

void dumpGlyph(struct glyph *g){
    printf("{%d,%d,%d,0,{", g->code, g->width, g->height);
    for(int i = 0; i < g->height; i++){
        printf("%d,", g->rows[i]);
    }
    printf("}},\n");
}

struct img {
    int w;
    int h;
    unsigned char * pixels;
};

int main(){
    int state = 0;

    InitWindow(SCREEN_W, SCREEN_H, "FIRE");
    SetWindowState(FLAG_VSYNC_HINT);

    Image screen = GenImageColor(REZ_W, REZ_H, WHITE); // create image for use as the screen
    ImageFormat(&screen, PIXELFORMAT_UNCOMPRESSED_GRAYSCALE); // convert to 1 byte per pixel
    Texture tex = LoadTextureFromImage(screen);

    Image screen2 = ImageCopy(screen);

    unsigned char * temp;
    unsigned char * front = screen.data;
    unsigned char * back  = screen2.data;

    for(int i = 0; i < 256; i++){
        colors[i][0] = rand_r(&state) % 256; 
        colors[i][1] = rand_r(&state) % 256;
        colors[i][2] = rand_r(&state) % 256;
    }

    for(int i = 0; i < REZ_W * REZ_H; i++){
        back[i]  = 0;
        front[i] = 0;
    }

    Shader s = LoadShaderFromMemory(NULL, shadercode);
    int paletteLoc = GetShaderLocation(s, "palette");
    SetShaderValueV(s, paletteLoc, colors, SHADER_UNIFORM_IVEC3, 256);
    
    int phase = 0;
    int phase2 = 0;

    while(!WindowShouldClose()){

        if(phase == 0){

            for(int i = 0; i < REZ_W; i++) {
                write(front, i, REZ_H-1, rand_r(&state));
            }

            for(int i = 0; i < REZ_W; i++) {
                for(int j = 0; j < REZ_H - 1; j++) {
                    int ss = sample(back, i, j);
                    //int s0 = sample(back, i, j + 1);
                    //int s1 = sample(back, i, j + 2);
                    //int s2 = sample(back, i, j + 3);
                    int s3 = sample(back, i+1, j + 1);
                    //int s4 = sample(back, i+2, j + 1);
                    //int s5 = sample(back, i-2, j + 1);
                    int s6 = sample(back, i-1, j);
                    //int s7 = sample(back, i+3, j + 1);
                    //int s8 = sample(back, i-4, j + 1);
                    write(front, i, j, (1*ss+4*s3+3*s6)/8);
                }
            }

        }
        else{
            for(int i =0; i < REZ_W * REZ_H; i++) front[i] = back[i];

            if(phase2 == 0){
                int numchars = rand() % 5 + 5;
                int col = rand() % 45;
                int base = rand() % 24;
                for(int i = 0; i < numchars; i++){
                    drawGlyph(col*7, (base + i)*12, &glyphs[rand()%256], front);
                }
            }
        }

        if(IsMouseButtonDown(0)){
            Vector2 pos = GetMousePosition();
            pos.x = pos.x / SCREEN_W * REZ_W;
            pos.y = pos.y / SCREEN_H * REZ_H;
            write(front, pos.x, pos.y, 255);
            write(front, pos.x+1, pos.y, 255);
            write(front, pos.x, pos.y+1, 255);
            write(front, pos.x-1, pos.y, 255);
            write(front, pos.x, pos.y-1, 255);
        }


        if(IsKeyPressed(KEY_UP)){
            printf("key up\n");
        }
        if(IsKeyPressed(KEY_RIGHT)){
            printf("key right\n");
        }
        if(IsKeyPressed(KEY_LEFT)){
            printf("key left\n");
        }
        if(IsKeyPressed(KEY_DOWN)){
            printf("key down\n");
        }

        phase ++;
        if(phase > 3) phase = 0;
        phase2 ++;
        if(phase2 > 4) phase2 = 0;

        UpdateTexture(tex, front);

        temp = back;
        back = front;
        front = temp;

        BeginDrawing();
        BeginShaderMode(s);
        Rectangle source = {0, 0, tex.width, tex.height};
        Rectangle dest   = {0, 0, SCREEN_W, SCREEN_H};
        Vector2 origin   = {0, 0};
        DrawTexturePro(tex, source, dest, origin, 0.0, WHITE);

        DrawFPS(200,200);
        EndShaderMode();
        EndDrawing();
    }

    CloseWindow();
}
